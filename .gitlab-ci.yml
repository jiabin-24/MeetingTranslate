stages:
  - deploy
  - build

variables:
  ORG_NAME: "NIUAI"
  LOCATION: "eastasia"

# Shared setup for all jobs: prepare powershell, dotnet, node and Az modules on Linux runners
before_script:
  - apt-get update -y
  - apt-get install -y wget apt-transport-https ca-certificates gnupg curl
  - wget -q https://packages.microsoft.com/config/ubuntu/22.04/packages-microsoft-prod.deb -O /tmp/packages-microsoft-prod.deb
  - dpkg -i /tmp/packages-microsoft-prod.deb || true
  - apt-get update -y
  - apt-get install -y powershell dotnet-sdk-8.0 nodejs npm || true
  - pwsh -NoProfile -NonInteractive -Command 'Write-Host "Preparing Linux environment..."; if (-not (Get-Module -ListAvailable -Name Az.Accounts)) { Install-Module -Name Az -Scope CurrentUser -Force -AllowClobber }'

# Include job definitions from ci/ for distribution and easier management.
include:
  - local: 'ci/templates/azure-login.yml'
  - local: 'ci/deploy.yml'
  - local: 'ci/build.yml'
